{{- if (eq (.Site.Params.disableComments | default false) false) -}}
    {{- if (eq (.Params.disableComments | default false) false) -}}
    <script type="text/javascript">
        (function() {
          const themeToggle = document.querySelector('.darkmode-toggle input');
          const light = 'light';
          const dark = 'dark';
          let isDark = localStorage.theme === dark || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches);
          let theme = isDark ? dark : light;
      
          const s = document.createElement('script');
          s.type = 'text/javascript';
          const dataset = {
            repo: '{{ .Site.Params.giscus.repo }}',

            repoId: '{{ .Site.Params.giscus.repoId }}',
            category: '{{ .Site.Params.giscus.category }}',
            categoryId: '{{ .Site.Params.giscus.categoryId }}',
            mapping: '{{ .Site.Params.giscus.mapping }}',
            reactionsEnabled: '{{ .Site.Params.giscus.reactionsEnabled }}',
            emitMetadata: '{{ .Site.Params.giscus.emitMetadata }}',
            theme: theme,
            lang: '{{ .Site.Params.giscus.lang }}',
          };s.src = 'https://giscus.app/client.js';
    s.crossorigin = 'anonymous';
    s.async = true;
    Object.entries(dataset).forEach(function(a) {
        return s.dataset[a[0]] = a[1];
    });

    const curScriptElement = document.currentScript;
    curScriptElement.parentNode.insertBefore(s, curScriptElement);

    function sendMessage(message) {
      const iframe = document.querySelector('iframe.giscus-frame');
      // console.log(iframe);
      if (!iframe) return;
      iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
    }

    themeToggle.addEventListener('change', function () {
      if (this.checked) {
        theme = dark;
      } else {
        theme = light;
      }
      sendMessage({
        setConfig: {
          theme: theme,
        }
      });
    });
  })();
</script>
    {{- end -}}
{{- end -}}